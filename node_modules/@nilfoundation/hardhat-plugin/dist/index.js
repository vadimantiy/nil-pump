"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config_1 = require("hardhat/config");
const interceptors_1 = require("./interceptors");
const setup_1 = require("./setup");
(0, config_1.extendEnvironment)((hre) => {
    const originalRequest = hre.network.provider.request.bind(hre.network.provider);
    const originalSend = hre.network.provider.send.bind(hre.network.provider);
    const contextPromise = (0, setup_1.setupWalletAndClient)(hre, originalRequest, originalSend);
    hre.network.provider.send = async (method, params) => {
        const context = await contextPromise;
        context.isRequest = false;
        return (0, interceptors_1.unifiedInterceptor)(method, params || [], context);
    };
    hre.network.provider.request = async (args) => {
        const context = await contextPromise;
        context.isRequest = true;
        const safeParams = Array.isArray(args.params)
            ? args.params
            : args.params
                ? [args.params]
                : [];
        return (0, interceptors_1.unifiedInterceptor)(args.method, safeParams, context);
    };
});
